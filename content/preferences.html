<!DOCTYPE html>

<html>
<head>
    <title>Preferences</title>
<style>
body {
    background-color: transparent !important;
}
button > img {
    width:  16px;
    height: 16px;
}
button > label {
    padding: 4px;
}
button {
    border-style: outset;
}
button[checked="checked"] {
    border-style: inset;
}
</style>
<script>

window.addEventListener("message", function(event) {
  if (!event.source) {
    // when xul sends the event, source is null
    var msg = JSON.parse(event.data);
    if (msg.topic == 'handlers') {
        var services = msg.data;
        //document.getElementById('output').value = event.data;
        for (var i=0; i < services.length; i++) {
            var svc = services[i];
            var btn = document.createElement('button');
            var img = document.createElement('img');
            var lbl = document.createElement('label');
            //dump("service: "+JSON.stringify(svc)+"\n");
            img.setAttribute('src', svc.icon);
            img.setAttribute('for', svc.name);
            lbl.setAttribute('for', svc.name);
            lbl.appendChild(document.createTextNode(svc.name));
            btn.setAttribute('type', "checkbox");
            btn.setAttribute('action', svc.action);
            btn.setAttribute('value', svc.url);
            btn.setAttribute('checked', svc.enabled ? "checked":"");
            btn.appendChild(img);
            btn.appendChild(lbl);
            btn.addEventListener('click', function(e) {
                var btn = e.target;
                var enabled = !(btn.getAttribute('checked')=="checked");
                btn.setAttribute('checked', enabled ? "checked":"");
                var response = JSON.stringify({
                  topic: "preference-change",
                  data: {
                    url: btn.getAttribute('value'),
                    action: btn.getAttribute('action'),
                    enabled: enabled
                  }
                });
                window.postMessage(response, "*");
            });
            document.getElementById('available-activities').appendChild(btn);
        }
    }
  }
}, false);

</script>
</head>

<body>
<h3>Preferences</h3>
<div>
<div id="available-activities"/>
<div>Ugly on purpose&trade;</div>
</div>

</body>
</html>
